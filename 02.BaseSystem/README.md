# 基础解决方案

## 微服务架构下的统一身份认证与授权

### OAuth2.0 的四种授权模式

* 授权码模式（authorization code）
* 简化模式（implicit）
* 密码模式（resource owner password credentials）
* 客户端模式（client credentials）

#其中密码模式常用于外部服务的认证、授权和鉴权，客户端模式常用于内部服务的认证、授权和鉴权和开放平台应用的授权，授权码模式常用于社会化登录和SSO。
#第一方应用通常采用OAuth2.0的密码模式，第三方接入应用通常采用授权码模式

### 权限验证逻辑

1.登录时验证用户名、客户端是否有效

* 管理端：通过密码模式+客户端模式（携带默认客户端）进行授权与验证
* 后台配置端：密码模式+客户端模式+授权码模式（携带租户）
* 用户端：密码模式+客户端模式+授权码模式（携带租户）
* 第三方服务：客户端模式+授权码模式（携带接入者身份）

#服务之间通过JWT进行身份验证

客户端通过携带Oauth AccessToken向网关发起请求，网关服务想Identity Server进行验证，如果Token有效则生成包含权限标识的JWT返回给网关，网关拿到 JWT 后利用公钥进行解密，
并校验权限标识，通过后再携带此JWT向业务服务转发请求，业务服务收到请求后，利用公钥解密JWT并自行检验其有效性、获取用户信息等，无须再请求Identity Server

#系统流程
#用户登录：用户请求携带客户端ID、客户端密钥、用户名、密码、授权码信息（后台配置端、用户端）到网关服务，网关服务验证用户信息

